{"title":"Jenkins","date":"2022-10-29T08:03:02.000Z","date_formatted":{"ll":"Oct 29, 2022","L":"10/29/2022","MM-DD":"10-29"},"link":"2022/10/29/Jenkins","updated":"2022-10-29T08:08:33.821Z","content":"<h2 id=\"gitlab\">gitlab<a title=\"#gitlab\" href=\"#gitlab\"></a></h2>\n<h3 id=\"centos7\">Centos7<a title=\"#centos7\" href=\"#centos7\"></a></h3>\n<h4 id=\"安装依赖\">安装依赖<a title=\"#安装依赖\" href=\"#安装依赖\"></a></h4>\n<p>sudo yum install -y curl policycoreutils-python openssh-server perl</p>\n<p>sudo systemctl enable sshd</p>\n<p>sudo systemctl start sshd</p>\n<h4 id=\"配置镜像\">配置镜像<a title=\"#配置镜像\" href=\"#配置镜像\"></a></h4>\n<p>curl -fsSL <a href=\"https://packages.gitlab.cn/repository/raw/scripts/setup.sh\" target=\"_blank\">https://packages.gitlab.cn/repository/raw/scripts/setup.sh</a> | /bin/bash</p>\n<h4 id=\"安装\">安装<a title=\"#安装\" href=\"#安装\"></a></h4>\n<p>sudo EXTERNAL_URL=“<a href=\"http://ip\" target=\"_blank\">http://ip</a>” yum install -y gitlab-jh</p>\n<h4 id=\"常用命令\">常用命令<a title=\"#常用命令\" href=\"#常用命令\"></a></h4>\n<p>启动所有gitlab组件：gitlab-ctl start</p>\n<p>停止所有gitlab组件：gitlab-ctl stop</p>\n<p>重启所有gitlab组件：gitlab-ctl restart</p>\n<p>查看服务状态：gitlab-ctl status</p>\n<p>启动服务：gitlab-ctl reconfigure</p>\n<p>修改默认配置文件：vi /etc/gitlab/gitlab.rb</p>\n<p>查看日志：gitlab-ctl tail</p>\n<h3 id=\"docker\">docker<a title=\"#docker\" href=\"#docker\"></a></h3>\n<p>参考地址：<a href=\"https://docs.gitlab.cn/jh/install/docker.html\" target=\"_blank\">https://docs.gitlab.cn/jh/install/docker.html</a></p>\n<p>docker run -d --name gitlab -p 443:443 -p 8090:80 -p 222:22 --restart always -v /home/docker/gitlab/config:/etc/gitlab -v /home/docker/gitlab/logs:/var/log/gitlab -v /home/docker/gitlab/data:/var/opt/gitlab --shm-size 256m <a href=\"http://registry.gitlab.cn/omnibus/gitlab-jh:latest\">registry.gitlab.cn/omnibus/gitlab-jh:latest</a></p>\n<h4 id=\"进入容器\">进入容器<a title=\"#进入容器\" href=\"#进入容器\"></a></h4>\n<p>docker exec -it gitlab /bin/bash</p>\n<h4 id=\"查看密码\">查看密码<a title=\"#查看密码\" href=\"#查看密码\"></a></h4>\n<p>cat /etc/gitlab/initial_root_password</p>\n<p><strong>配置请在容器内进行修改，不要在挂载到宿主机的文件上进行修改。否则可能出现配置更新不到容器内，或者是不能即时更新到容器内，导致gitlab启动成功，但是无法访问</strong></p>\n<p>修改配置</p>\n<p>进容器内部：docker exec -it gitlab /bin/bash</p>\n<p>修改gitlab.rb：vi /etc/gitlab/gitlab.rb</p>\n<p>加入如下：#gitlab访问地址，可以写域名。如果端口不写的话默认为80端口 external_url ‘<a href=\"http://ip\" target=\"_blank\">http://ip</a>:port’</p>\n<p>ssh主机ip：gitlab_rails[‘gitlab_ssh_host’] = ‘ip’</p>\n<p>ssh连接端口：gitlab_rails[‘gitlab_shell_ssh_port’] = ssh-port</p>\n<p>让配置生效：gitlab-ctl reconfigure</p>\n<p><strong>注意不要重启，/etc/gitlab/gitlab.rb文件的配置会映射到gitlab.yml这个文件，在docker中运行，在gitlab上生成的http地址应该是<a href=\"http://ip\" target=\"_blank\">http://ip</a>:port，所以要修改下面文件</strong></p>\n<p>修改http和ssh配置：vi /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml</p>\n <figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">gitlab:</span></span><br><span class=\"line\">  <span class=\"attr\">host:</span> <span class=\"string\">ip</span></span><br><span class=\"line\">  <span class=\"attr\">port:</span> <span class=\"string\">port</span></span><br><span class=\"line\">  <span class=\"attr\">https:</span> <span class=\"literal\">false</span></span><br></pre></td></tr></table></figure>\n<p>重启gitlab：gitlab-ctl restart</p>\n","prev":{"title":"RocketMQ","link":"2022/10/30/MQ/RocketMQ"},"next":{"title":"Flutter","link":"2022/10/29/Flutter"},"plink":"http://example.com/2022/10/29/Jenkins/","toc":[{"id":"gitlab","title":"gitlab","index":"1","children":[{"id":"centos7","title":"Centos7","index":"1.1","children":[{"id":"安装依赖","title":"安装依赖","index":"1.1.1"},{"id":"配置镜像","title":"配置镜像","index":"1.1.2"},{"id":"安装","title":"安装","index":"1.1.3"},{"id":"常用命令","title":"常用命令","index":"1.1.4"}]},{"id":"docker","title":"docker","index":"1.2","children":[{"id":"进入容器","title":"进入容器","index":"1.2.1"},{"id":"查看密码","title":"查看密码","index":"1.2.2"}]}]}],"reading_time":"439 words in 3 min"}