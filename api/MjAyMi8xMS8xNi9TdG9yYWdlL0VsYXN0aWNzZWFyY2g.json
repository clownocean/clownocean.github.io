{"title":"Elasticsearch","date":"2022-11-16T14:55:30.000Z","date_formatted":{"ll":"Nov 16, 2022","L":"11/16/2022","MM-DD":"11-16"},"link":"2022/11/16/Storage/Elasticsearch","updated":"2022-12-04T07:14:11.008Z","content":"<h1 id=\"elasticsearch\">Elasticsearch<a title=\"#elasticsearch\" href=\"#elasticsearch\"></a></h1>\n<p><a href=\"https://www.elastic.co/cn/downloads/past-releases#elasticsearch\" target=\"_blank\">https://www.elastic.co/cn/downloads/past-releases#elasticsearch</a></p>\n<h2 id=\"单机安装\">单机安装<a title=\"#单机安装\" href=\"#单机安装\"></a></h2>\n<p><strong>解压</strong></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf jdk-8u341-linux-x64.tar.gz</span><br><span class=\"line\">tar -xvf elasticsearch-7.3.0-linux-x86_64.tar.gz</span><br><span class=\"line\">sudo mv jdk1.8.0_341 /usr/</span><br><span class=\"line\">sudo mv elasticsearch-7.3.0 /usr/</span><br></pre></td></tr></table></figure>\n<p><strong>配置环境变量</strong></p>\n<p>sudo vi /etc/profile</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">export</span> <span class=\"string\">JAVA_HOME=/usr/jdk1.8.0_341</span></span><br><span class=\"line\"><span class=\"attr\">export</span> <span class=\"string\">JRE_HOME=/usr/jdk1.8.0_341/jre</span></span><br><span class=\"line\"><span class=\"attr\">export</span> <span class=\"string\">CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</span></span><br><span class=\"line\"><span class=\"attr\">export</span> <span class=\"string\">PATH=$JAVA_HOME/bin:$JRE_HOME/bin:$PATH</span></span><br></pre></td></tr></table></figure>\n<p><strong>配置生效</strong></p>\n<p>source /etc/profile</p>\n<p>配置Elasticsearch</p>\n<p>vi /usr/elasticsearch-7.3.0/config/elasticsearch.yml</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">node.name:</span> <span class=\"string\">node-1</span></span><br><span class=\"line\"><span class=\"attr\">network.host:</span> <span class=\"number\">192.168</span><span class=\"number\">.0</span><span class=\"number\">.1</span></span><br><span class=\"line\"><span class=\"attr\">http.port:</span> <span class=\"number\">9200</span></span><br><span class=\"line\"><span class=\"attr\">cluster.initial_master_nodes:</span> [<span class=\"string\">&quot;node-1&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p>内存设置</p>\n<p>vi /usr/elasticsearch-7.3.0/config/jvm.options</p>\n<blockquote>\n<p>根据实际情况修改占用内存，默认1G。内存设置超出物理内存，启动报错无法启动</p>\n</blockquote>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">-Xms1g</span></span><br><span class=\"line\"><span class=\"attr\">-Xmx1g</span></span><br></pre></td></tr></table></figure>\n<p>添加用户</p>\n<blockquote>\n<p>默认root用户无法启动，需更改为其他用户</p>\n</blockquote>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd xxx</span><br><span class=\"line\">passwd xxx</span><br></pre></td></tr></table></figure>\n<p>更改es目录拥有者</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R xxx /usr/elasticsearch-7.3.0/</span><br></pre></td></tr></table></figure>\n<p>最大内存映射</p>\n<p>vi /etc/sysctl.conf</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">vm.max_map_count</span>=<span class=\"string\">655360</span></span><br></pre></td></tr></table></figure>\n<p>重启生效 sysctl -p</p>\n<p>安全配置</p>\n<p>vi /etc/security/limits.conf</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">*</span>    <span class=\"string\">soft    nofile    65536</span></span><br><span class=\"line\"><span class=\"attr\">*</span>    <span class=\"string\">hard    nofile    65536</span></span><br><span class=\"line\"><span class=\"attr\">*</span>    <span class=\"string\">soft    nproc     4096</span></span><br><span class=\"line\"><span class=\"attr\">*</span>    <span class=\"string\">hard    nproc     4096</span></span><br></pre></td></tr></table></figure>\n<p>启动</p>\n<p>切换用户 su xxx</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/elasticsearch-7.3.0/bin/elasticsearch</span><br></pre></td></tr></table></figure>\n<h1 id=\"kibana\">Kibana<a title=\"#kibana\" href=\"#kibana\"></a></h1>\n<p><a href=\"https://www.elastic.co/cn/downloads/past-releases#kibana\" target=\"_blank\">https://www.elastic.co/cn/downloads/past-releases#kibana</a></p>\n<p>解压、移动</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">tar -xvf kibana-7.3.0-linux-x86_64.tar.gz</span><br><span class=\"line\">sudo mv kibana-7.3.0 /usr/</span><br></pre></td></tr></table></figure>\n<p>更改kibana目录拥有者</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chown -R xxx /usr/kibana-7.3.0/</span><br></pre></td></tr></table></figure>\n<p>设置访问权限</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod -R 777 /usr/kibana-7.3.0/</span><br></pre></td></tr></table></figure>\n<p>修改配置文件</p>\n<p>vi /usr/kibana-7.3.0/config/kibana.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">server.port:</span> <span class=\"number\">5601</span></span><br><span class=\"line\"><span class=\"attr\">server.host:</span> <span class=\"string\">&quot;0.0.0.0&quot;</span></span><br><span class=\"line\"><span class=\"attr\">elasticsearch.hosts:</span> [<span class=\"string\">&quot;http://ip:9200&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p>切换用户 su xxx</p>\n<p>启动</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/kibana-7.3.0/bin/kibana</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Default Kibana configuration for docker target</span></span><br><span class=\"line\"><span class=\"attr\">server.name</span>: <span class=\"string\">kibana</span></span><br><span class=\"line\"><span class=\"attr\">server.host</span>: <span class=\"string\">&quot;0&quot;</span></span><br><span class=\"line\"><span class=\"attr\">elasticsearch.hosts</span>: <span class=\"string\">[ &quot;http://172.17.0.3:9200&quot; ]</span></span><br><span class=\"line\"><span class=\"attr\">xpack.monitoring.ui.container.elasticsearch.enabled</span>: <span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">elasticsearch.username</span>: <span class=\"string\">&quot;elastic&quot;</span></span><br><span class=\"line\"><span class=\"attr\">elasticsearch.password</span>: <span class=\"string\">&quot;&quot;</span></span><br></pre></td></tr></table></figure>\n<p>单机镜像</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull elasticsearch:7.3.0</span><br></pre></td></tr></table></figure>\n<p>配置</p>\n<p>vi /usr/share/elasticsearch/config/elasticsearch.yml</p>\n<figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">xpack.security.enabled</span>: <span class=\"string\">true</span></span><br><span class=\"line\"><span class=\"attr\">xpack.security.transport.ssl.enabled</span>: <span class=\"string\">true</span></span><br></pre></td></tr></table></figure>\n<p>error</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ERROR: [1] bootstrap checks failed</span><br><span class=\"line\">[1]: Transport SSL must be enabled if security is enabled on a [basic] license. Please set [xpack.security.transport.ssl.enabled] to [true] or disable security by setting [xpack.security.enabled] to [false]</span><br></pre></td></tr></table></figure>\n<p>密码设置</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root@VM-4-10-centos ~]# docker exec -it es7 /bin/bash</span><br><span class=\"line\">[root@7aa3b77abc06 elasticsearch]# cd bin</span><br><span class=\"line\">[root@7aa3b77abc06 bin]# elasticsearch-setup-passwords interactive</span><br><span class=\"line\">Initiating the setup of passwords for reserved users elastic,apm_system,kibana,logstash_system,beats_system,remote_monitoring_user.</span><br><span class=\"line\">You will be prompted to enter passwords as the process progresses.</span><br><span class=\"line\">Please confirm that you would like to continue [y/N]y</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Enter password for [elastic]: </span><br><span class=\"line\">Reenter password for [elastic]: </span><br><span class=\"line\">Enter password for [apm_system]: </span><br><span class=\"line\">Reenter password for [apm_system]: </span><br><span class=\"line\">Enter password for [kibana]: </span><br><span class=\"line\">Reenter password for [kibana]: </span><br><span class=\"line\">Enter password for [logstash_system]: </span><br><span class=\"line\">Reenter password for [logstash_system]: </span><br><span class=\"line\">Enter password for [beats_system]: </span><br><span class=\"line\">Reenter password for [beats_system]: </span><br><span class=\"line\">Enter password for [remote_monitoring_user]: </span><br><span class=\"line\">Reenter password for [remote_monitoring_user]: </span><br><span class=\"line\">Changed password for user [apm_system]</span><br><span class=\"line\">Changed password for user [kibana]</span><br><span class=\"line\">Changed password for user [logstash_system]</span><br><span class=\"line\">Changed password for user [beats_system]</span><br><span class=\"line\">Changed password for user [remote_monitoring_user]</span><br><span class=\"line\">Changed password for user [elastic]</span><br></pre></td></tr></table></figure>\n<p>默认用户名elastic</p>\n<h1 id=\"ik分词器\">IK分词器<a title=\"#ik分词器\" href=\"#ik分词器\"></a></h1>\n<p><a href=\"https://github.com/medcl/elasticsearch-analysis-ik/releases\" target=\"_blank\">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>\n<ol>\n<li>download or compile</li>\n</ol>\n<ul>\n<li>\n<p>download pre-build package from here: <a href=\"https://github.com/medcl/elasticsearch-analysis-ik/releases\" target=\"_blank\">https://github.com/medcl/elasticsearch-analysis-ik/releases</a></p>\n<p>create plugin folder <code>cd your-es-root/plugins/ &amp;&amp; mkdir ik</code></p>\n<p>unzip plugin to folder <code>your-es-root/plugins/ik</code></p>\n</li>\n<li>\n<p>use elasticsearch-plugin to install ( supported from version v5.5.1 )</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">./bin/elasticsearch-plugin install https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.3.0/elasticsearch-analysis-ik-7.3.0.zip</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<ol start=\"2\">\n<li>restart elasticsearch</li>\n</ol>\n<p>IK分词模式</p>\n<ul>\n<li>\n<p>ik_max_word</p>\n<p>文本最细力度拆分</p>\n</li>\n<li>\n<p>ik_smart</p>\n<p>文本最粗粒度拆分</p>\n</li>\n</ul>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class=\"line\">\t&quot;text&quot;: &quot;南京市长江大桥&quot;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">POST _analyze</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t&quot;analyzer&quot;: &quot;ik_smart&quot;,</span><br><span class=\"line\">\t&quot;text&quot;: &quot;南京市长江大桥&quot;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>扩展词典</p>\n<p>自定义扩展词库</p>\n<p>定位非法搜索</p>\n<p>聚合</p>\n<h2 id=\"零停机索引重建\">零停机索引重建<a title=\"#零停机索引重建\" href=\"#零停机索引重建\"></a></h2>\n<h2 id=\"智能搜索\">智能搜索<a title=\"#智能搜索\" href=\"#智能搜索\"></a></h2>\n<h2 id=\"分布式集群\">分布式集群<a title=\"#分布式集群\" href=\"#分布式集群\"></a></h2>\n<p>Springboot集成elasticsearch</p>\n<details>\n    <summary>点击时的区域标题：点击查看详细内容</summary>\n    <p> - 测试 测试测试</p>\n    <pre>\n        elasticsearch:\n          hosts: xxx:9200\n          username: \n          password: \n    </pre>\n</details>\n<details>\n    <summary>点击时的区域标题：点击查看详细内容</summary>\n    <p> - 测试 测试测试</p>\n    <pre><code>\n        package com.demo.config;\nimport lombok.Data;\nimport org.apache.http.HttpHost;\nimport org.apache.http.auth.AuthScope;\nimport org.apache.http.auth.UsernamePasswordCredentials;\nimport org.apache.http.client.CredentialsProvider;\nimport org.apache.http.impl.client.BasicCredentialsProvider;\nimport org.elasticsearch.client.RestClient;\nimport org.elasticsearch.client.RestClientBuilder;\nimport org.elasticsearch.client.RestHighLevelClient;\nimport org.springframework.boot.context.properties.ConfigurationProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.stereotype.Component;\n/**\n * @author Nevers\n */\n@Data\n@Component\n@ConfigurationProperties(prefix = \"elasticsearch\")\npublic class ElasticsearchConfig &#123;\n    private String hosts;\n    private String username;\n    private String password;\n    @Bean\n    public RestHighLevelClient restHighLevelClient() &#123;\n        // 解析elasticsearch地址\n        String[] host = hosts.split(\",\");\n        // 封装主机和端口\n        HttpHost[] httpHosts = new HttpHost[host.length];\n        for (int i = 0; i < httpHosts.length; i++) &#123;\n            String[] url = host[i].split(\":\");\n            httpHosts[i] = new HttpHost(url[0], Integer.parseInt(url[1]), \"http\");\n        &#125;\n        RestClientBuilder restClientBuilder = RestClient.builder(httpHosts);\n        // 设置用户名和密码\n        CredentialsProvider credentialsProvider = new BasicCredentialsProvider();\n        credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials(username, password));\n        restClientBuilder.setHttpClientConfigCallback(clientBuilder -> clientBuilder.setDefaultCredentialsProvider(credentialsProvider));\n        return new RestHighLevelClient(restClientBuilder);\n    &#125;\n&#125; \n </code></pre>\n</details>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.6.7<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>springboot-elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.source</span>&gt;</span>11<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.source</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">maven.compiler.target</span>&gt;</span>11<span class=\"tag\">&lt;/<span class=\"name\">maven.compiler.target</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.elasticsearch.client<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>7.3.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>elasticsearch<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>7.3.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.projectlombok<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lombok<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">elasticsearch:</span></span><br><span class=\"line\">  <span class=\"attr\">hosts:</span> <span class=\"string\">xxx:9200</span></span><br><span class=\"line\">  <span class=\"attr\">username:</span> </span><br><span class=\"line\">  <span class=\"attr\">password:</span> </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.demo.config;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> lombok.Data;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.HttpHost;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.auth.AuthScope;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.auth.UsernamePasswordCredentials;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.client.CredentialsProvider;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.apache.http.impl.client.BasicCredentialsProvider;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.RestClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.RestClientBuilder;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.elasticsearch.client.RestHighLevelClient;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.context.annotation.Bean;</span><br><span class=\"line\"><span class=\"keyword\">import</span> org.springframework.stereotype.Component;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Nevers</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;elasticsearch&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ElasticsearchConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String hosts;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String username;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String password;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RestHighLevelClient <span class=\"title function_\">restHighLevelClient</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 解析elasticsearch地址</span></span><br><span class=\"line\">        String[] host = hosts.split(<span class=\"string\">&quot;,&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 封装主机和端口</span></span><br><span class=\"line\">        HttpHost[] httpHosts = <span class=\"keyword\">new</span> <span class=\"title class_\">HttpHost</span>[host.length];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; httpHosts.length; i++) &#123;</span><br><span class=\"line\">            String[] url = host[i].split(<span class=\"string\">&quot;:&quot;</span>);</span><br><span class=\"line\">            httpHosts[i] = <span class=\"keyword\">new</span> <span class=\"title class_\">HttpHost</span>(url[<span class=\"number\">0</span>], Integer.parseInt(url[<span class=\"number\">1</span>]), <span class=\"string\">&quot;http&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">RestClientBuilder</span> <span class=\"variable\">restClientBuilder</span> <span class=\"operator\">=</span> RestClient.builder(httpHosts);</span><br><span class=\"line\">        <span class=\"comment\">// 设置用户名和密码</span></span><br><span class=\"line\">        <span class=\"type\">CredentialsProvider</span> <span class=\"variable\">credentialsProvider</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">BasicCredentialsProvider</span>();</span><br><span class=\"line\">        credentialsProvider.setCredentials(AuthScope.ANY, <span class=\"keyword\">new</span> <span class=\"title class_\">UsernamePasswordCredentials</span>(username, password));</span><br><span class=\"line\">        restClientBuilder.setHttpClientConfigCallback(clientBuilder -&gt; clientBuilder.setDefaultCredentialsProvider(credentialsProvider));</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RestHighLevelClient</span>(restClientBuilder);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"Redis","link":"2022/12/03/Storage/Redis"},"next":{"title":"Netty","link":"2022/11/12/Netty"},"plink":"http://example.com/2022/11/16/Storage/Elasticsearch/","toc":[{"id":"elasticsearch","title":"Elasticsearch","index":"1","children":[{"id":"单机安装","title":"单机安装","index":"1.1"}]},{"id":"kibana","title":"Kibana","index":"2"},{"id":"ik分词器","title":"IK分词器","index":"3","children":[{"id":"零停机索引重建","title":"零停机索引重建","index":"3.1"},{"id":"智能搜索","title":"智能搜索","index":"3.2"},{"id":"分布式集群","title":"分布式集群","index":"3.3"}]}],"reading_time":"1577 words in 11 min"}